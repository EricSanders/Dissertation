from collections import OrderedDict

electionresults = OrderedDict()
for year in ('2011','2012','2015','2017','2019'):
    electionresults[year] = OrderedDict()

electionresults['2011']['vvd'] = 1368398
electionresults['2011']['pvda'] = 1211111
electionresults['2011']['cda'] = 987282
electionresults['2011']['pvv'] = 869626
electionresults['2011']['sp'] = 710425
electionresults['2011']['d66'] = 585195
electionresults['2011']['gl'] = 440687
electionresults['2011']['cu'] = 231131
electionresults['2011']['50plus'] = 164928
electionresults['2011']['sgp'] = 152441
electionresults['2011']['pvdd'] = 131231
electionresults['2011']['fnpo'] = 27288
    
electionresults['2012']['vvd'] = 2504948
electionresults['2012']['pvda'] = 2340750
electionresults['2012']['cda'] = 801620
electionresults['2012']['pvv'] = 950263
electionresults['2012']['sp'] = 909853
electionresults['2012']['d66'] = 757091
electionresults['2012']['gl'] = 219896
electionresults['2012']['cu'] = 294586
electionresults['2012']['50plus'] = 177631
electionresults['2012']['sgp'] = 196780
electionresults['2012']['pvdd'] = 182162
electionresults['2012']['ppnl'] = 30600
    
electionresults['2015']['vvd'] = 965353
electionresults['2015']['pvda'] = 611262
electionresults['2015']['cda'] = 891845
electionresults['2015']['pvv'] = 711176
electionresults['2015']['sp'] = 706440
electionresults['2015']['d66'] = 755719
electionresults['2015']['gl'] = 324572
electionresults['2015']['cu'] = 243209
electionresults['2015']['50plus'] = 204858
electionresults['2015']['sgp'] = 170624
electionresults['2015']['pvdd'] = 210113
electionresults['2015']['fnpo'] = 25027
        
electionresults['2017']['vvd'] = 2238351
electionresults['2017']['pvda'] = 599699
electionresults['2017']['cda'] = 1301796
electionresults['2017']['pvv'] = 1372941
electionresults['2017']['sp'] = 955633
electionresults['2017']['d66'] = 1285819
electionresults['2017']['gl'] = 959600
electionresults['2017']['cu'] = 256271
electionresults['2017']['50plus'] = 327131
electionresults['2017']['sgp'] = 218950
electionresults['2017']['pvdd'] = 335214
electionresults['2017']['denk'] = 216147
electionresults['2017']['fvd'] = 187162
electionresults['2017']['vnl'] = 38209
electionresults['2017']['ppnl'] = 35478 
electionresults['2017']['artikel1'] = 28700
electionresults['2017']['nw'] = 14362 
electionresults['2017']['op'] = 12570
electionresults['2017']['geenpeil'] = 4945
electionresults['2017']['jezus'] = 3099

electionresults['2019']['vvd'] = 4+4+6+6+6+8+9+9+4+10+5
electionresults['2019']['pvda'] = 5+6+6+3+4+5+6+5+4+3+3
electionresults['2019']['cda'] = 3+8+5+4+9+7+4+4+7+8+9
electionresults['2019']['pvv'] = 2+3+3+4+3+3+3+4+2+4+7
electionresults['2019']['sp'] = 4+2+3+2+3+3+3+2+2+5+4
electionresults['2019']['d66'] = 3+2+2+2+3+4+6+5+1+5+3
electionresults['2019']['gl'] = 6+3+4+4+5+6+9+5+2+5+4
electionresults['2019']['cu'] = 4+3+3+3+4+4+1+3+2+1+0
electionresults['2019']['50plus'] = 0+1+1+2+1+2+0+2+2+2+1 
electionresults['2019']['sgp'] = 0+0+0+1+2+3+0+2+5+0+0
electionresults['2019']['pvdd'] = 2+1+1+2+1+2+3+2+1+2+2
electionresults['2019']['denk'] = 0+0+0+0+0+0+1+1+0+0+0
electionresults['2019']['fvd'] = 5+6+6+8+6+8+9+11+5+9+7

pollmdhresults = OrderedDict()
for year in ('2011','2012','2015','2017','2019'):
    pollmdhresults[year] = OrderedDict()

pollmdhresults['2011']['vvd'] = 16
pollmdhresults['2011']['pvda'] = 11
pollmdhresults['2011']['cda'] = 9
pollmdhresults['2011']['pvv'] = 12
pollmdhresults['2011']['sp'] = 9
pollmdhresults['2011']['d66'] = 5
pollmdhresults['2011']['gl'] = 4
pollmdhresults['2011']['cu'] = 3
pollmdhresults['2011']['50plus'] = 2
pollmdhresults['2011']['sgp'] = 2
pollmdhresults['2011']['pvdd'] = 2
pollmdhresults['2011']['fnpo'] = 0
    
pollmdhresults['2012']['vvd'] = 36
pollmdhresults['2012']['pvda'] = 36
pollmdhresults['2012']['cda'] = 12
pollmdhresults['2012']['pvv'] = 18
pollmdhresults['2012']['sp'] = 20
pollmdhresults['2012']['d66'] = 11
pollmdhresults['2012']['gl'] = 4
pollmdhresults['2012']['cu'] = 5
pollmdhresults['2012']['50plus'] = 2
pollmdhresults['2012']['sgp'] = 3
pollmdhresults['2012']['pvdd'] = 3
pollmdhresults['2012']['ppnl'] = 0
    
pollmdhresults['2015']['vvd'] = 23
pollmdhresults['2015']['pvda'] = 14
pollmdhresults['2015']['cda'] = 22
pollmdhresults['2015']['pvv'] = 24
pollmdhresults['2015']['sp'] = 20
pollmdhresults['2015']['d66'] = 21
pollmdhresults['2015']['gl'] = 9
pollmdhresults['2015']['cu'] = 6
pollmdhresults['2015']['50plus'] = 3
pollmdhresults['2015']['sgp'] = 4
pollmdhresults['2015']['pvdd'] = 4
pollmdhresults['2015']['fnpo'] = 0
        
pollmdhresults['2017']['vvd'] = 27
pollmdhresults['2017']['pvda'] = 9
pollmdhresults['2017']['cda'] = 22
pollmdhresults['2017']['pvv'] = 24
pollmdhresults['2017']['sp'] = 13
pollmdhresults['2017']['d66'] = 15
pollmdhresults['2017']['gl'] = 18
pollmdhresults['2017']['cu'] = 5
pollmdhresults['2017']['50plus'] = 4
pollmdhresults['2017']['sgp'] = 3
pollmdhresults['2017']['pvdd'] = 4
pollmdhresults['2017']['denk'] = 3
pollmdhresults['2017']['fvd'] = 3
pollmdhresults['2017']['vnl'] = 0
pollmdhresults['2017']['ppnl'] = 0
pollmdhresults['2017']['artikel1'] = 0
pollmdhresults['2017']['nw'] = 0
pollmdhresults['2017']['op'] = 0
pollmdhresults['2017']['geenpeil'] = 0
pollmdhresults['2017']['jezus'] = 0

pollmdhresults['2019']['vvd'] = 11
pollmdhresults['2019']['pvda'] = 6
pollmdhresults['2019']['cda'] = 8
pollmdhresults['2019']['pvv'] = 7
pollmdhresults['2019']['sp'] = 5
pollmdhresults['2019']['d66'] = 6
pollmdhresults['2019']['gl'] = 8
pollmdhresults['2019']['cu'] = 3
pollmdhresults['2019']['50plus'] = 2
pollmdhresults['2019']['sgp'] = 2
pollmdhresults['2019']['pvdd'] = 2
pollmdhresults['2019']['denk'] = 2
pollmdhresults['2019']['fvd'] = 11


seatsperyear = OrderedDict()
seatsperyear['2011'] = 75
seatsperyear['2012'] = 150
seatsperyear['2015'] = 75
seatsperyear['2017'] = 150
seatsperyear['2019'] = 75

def getpercentages(counts,outparties = {'2011':[],'2012':[],'2015':[],'2017':[],'2019':[]}):
    #print(outparties)
    percentages = OrderedDict()
    totcount = OrderedDict()
    for year in (['2011','2012','2015','2017','2019']):
        #print(year)
        #print(outparties[year])
        percentages[year] = OrderedDict()
        totcount[year] = 0
        for party in counts[year]:
            #print(party)
            if not party in outparties[year]:
                totcount[year] += counts[year][party]
                #print(totcount[year])
        for party in counts[year]:
            if not party in outparties[year]:
                #print(party)
                #print(totcount[year])
                percentages[year][party] = 100 * counts[year][party] / totcount[year]

    return(percentages)
    
def getseats(counts,outparties = {'2011':[],'2012':[],'2015':[],'2017':[],'2019':[]}):
    seats = OrderedDict()
    totcount = OrderedDict()
    partyrestpercentages = OrderedDict()
    for year in (['2011','2012','2015','2017','2019']):
        #print(year)
        totnrseats = seatsperyear[year]
        seats[year] = OrderedDict()
        totcount[year] = 0
        for party in counts[year]:
            #print(party)
            if not party in outparties[year]:
                totcount[year] += counts[year][party]
                #print(totcount[year])
        for party in counts[year]:
            if not party in outparties[year]:
                #print(totcount[year])

                ### compute seats ###
                seats[year][party] = int(totnrseats * counts[year][party] / totcount[year])
                partyrestpercentages[party] = totnrseats * counts[year][party] / totcount[year] - seats[year][party]

        ### add rest seats ###
        for party in sorted(partyrestpercentages, key=partyrestpercentages.get, reverse=True):
            if not party in outparties[year]:
                if sumofseats(seats[year]) < totnrseats:
                    if not party in seats[year]:
                        seats[year][party] = 0
                    seats[year][party] += 1

    return(seats)

def sumofseats(seats):
    sumofseats = 0
    for party in seats:
        sumofseats += seats[party]

    return(sumofseats)

def getpartieswithseats(electioncounts,pollcounts):
    inparties = OrderedDict()
    outparties = OrderedDict()
    electionseats = getseats(electioncounts)
    pollseats = getseats(pollcounts)
    for year in electioncounts:
        inparties[year] = []
        outparties[year] = []
        #print(year)
        #print(electionseats[year])
        #print(pollseats[year])
        for party in electioncounts[year]:
            if electionseats[year][party] > 0 or pollseats[year][party] > 0:
                inparties[year].append(party)
            else:
                outparties[year].append(party)

    return(inparties,outparties)
